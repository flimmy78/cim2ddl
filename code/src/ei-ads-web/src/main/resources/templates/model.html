<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
   <title>模型查看</title>
   <div th:replace="fragments/header :: header-css" /></div>
   <style>
   	  nav#table-nav {
   	  	float:left;
		margin: 0;
		padding: 0;
		border: 0;
		width: 200px;
		background: transparent;
   	  }
   	  div#page-wrapper {
   	  	float: left;
		margin: 0;
		padding: 0;
		border: 0;
		width: 600px;
		background: transparent;
   	  }
   	  
   	  ul.dbcategory {
   	  	margin:0 0 0 15px;
   	  	padding:0;
   	  }
   	  
   	  li.nav-expand-btn {
   	  	float: right;
   	  }
   </style>
</head>
<body>
 <div  th:replace="fragments/header :: header"></div>
 <div class="container-fluid">  
 	   <nav id="table-nav" class="navbar-default navbar-static-side" role="navigation">		
		    <div  class="sidebar-collapse" id="categories">
			    <ul class="nav" id="side-menu">
			    </ul>
		    </div>
	   	    
 	    </nav>

	    <div id="page-wrapper" class="dashbard-1">
	        <div class="ibox-content">
		        <table class="table table-striped table-bordered table-hover">
		            <thead>
		        	<tr>
		        	   <th>col1</th>
		        	   <th>col2</th>
		        	</tr>
		        	<thead>
		        	<tbody>
			        	<tr class="gradeX">
			        	   <td>val11</td>
			        	   <td>val12</td>
			        	</tr>  
		        	</tbody>      	
		        </table>
	        </div>
	    </div> 	
 	</div>

   <!-- /.container -->
    <div th:replace="fragments/footer :: footer"></div>



</body>
<script>

  var loadRecoreds = function(categorytype, dbid, tableId) {
	  
	   
	   $.ajax({
			url : "model/records/"+categorytype+"/"+dbid+"/"+tableId,
			type : "GET",
			data : null,

			success : function(records) {
				console.log("record size = " + records.length+", table = "+tableId);    
			},
			error : function() {
				alert("fail to get records  in table :" + tableId);
			}
		});
  }
   
   var loadTables = function(categorytype, categoryid, dbid, ulist)  
   {
	   //alert(categoryname);
	   $.ajax({
			url : "model/tables/"+categorytype+"/"+dbid,
			type : "GET",
			data : null,

			success : function(tables) {
				console.log("tables = " + JSON.stringify(tables));
										
				for (var i = 0; i < tables.length; i++ ) {
					var table = tables[i];
					ulist.append("<li class='"+categoryid+"'><a href='#'  id='"+table.name+"' data-toggle='tooltip' title='"+table.name+"'><i class='fa fa-navicon'></i>"+table.alias+"</a></li>");
				}
				ulist.find("."+categoryid+" a").click(function() {
			        
			        var tableId = $(this).attr('id');
			        loadRecoreds(categorytype, dbid, tableId);
			       // alert('here in '+tableName);
			       // document.getElementById(divId).className = '';
			    });
			     
			},
			error : function() {
				alert("get tables failed in category :" + categoryname);
			}
		});
   }

   $(function() {
	    $('[data-toggle="tooltip"]').tooltip();    

		$.ajax({
			url : "model/categories",
			type : "GET",
			data : null,

			success : function(list) {
				console.log("categories = " + JSON.stringify(list));
				var categories = $("#categories").children("ul");
				
				
				
				for (var i = 0; i < list.length; i++ ) {
					//alert("hi");
					var itemid = "db"+i;
					var category = list[i];
	
					//categories.append("<li id='"+categoryid+"'><span><i class='fa fa fa-volume-up'></i> <a href=''>"+categoryname+"</a></span></li>");
					categories.append("<li class='"+category.type+"' id='"+itemid+"'> <a href='javascript:void(0)' data-toggle='tooltip' title= '"+category.name+"'><i class='fa fa-folder'></i>"
	                        +"<span class='nav-label'>   "+category.alias+"   </span>"
	                        +"<span class='nav-expand-btn fa fa-caret-left'></span>"
	                    +"</a></li>");
					var category_element = $("#"+itemid);
					category_element.append("<ul class='dbcategory nav nav-second-level collapse in'></ul>");

					var ul_element = $("#"+itemid).children("ul");
					if (i != 0) {
						ul_element.hide();
					}
					
					loadTables(category.type, itemid, category.id, ul_element);
					
				}
				//alert(categories);

			    $(".fa-caret-left").click(function () {
			        var l = $(this).parent().siblings("ul");
			        l.toggle();
			    });
				

			},
			error : function() {
				alert("get categories failed!");
			}
		});

   });
</script>
</html>